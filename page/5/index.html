<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//gravatar.com/avatar/e8050a565f388a2d35b46a8ed2aa0147?s=180">
  <link rel="icon" type="image/png" sizes="32x32" href="//gravatar.com/avatar/e8050a565f388a2d35b46a8ed2aa0147?s=32">
  <link rel="icon" type="image/png" sizes="16x16" href="//gravatar.com/avatar/e8050a565f388a2d35b46a8ed2aa0147?s=16">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mudkip.me","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Mudkip Mud Sport">
<meta property="og:url" content="https://mudkip.me/page/5/index.html">
<meta property="og:site_name" content="Mudkip Mud Sport">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Mudkip">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://mudkip.me/page/5/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Mudkip Mud Sport</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><meta name="fediverse:creator" content="@mudkip@indieweb.social"><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="Mudkip Mud Sport" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Mudkip Mud Sport</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Mudkip's Mud Sport Journal</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-uses"><a href="/uses/" rel="section"><i class="fa fa-computer fa-fw"></i>Uses</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Mudkip</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/mudkipme" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mudkipme" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://indieweb.social/@mudkip" title="Mastodon → https:&#x2F;&#x2F;indieweb.social&#x2F;@mudkip" rel="noopener me" target="_blank"><i class="fab fa-mastodon fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mudkip.me/2015/05/01/iOS-%E7%9A%84-hitTest-%E5%92%8C-pointInside-%E5%B0%8F%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mudkip">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/05/01/iOS-%E7%9A%84-hitTest-%E5%92%8C-pointInside-%E5%B0%8F%E7%BB%93/" class="post-title-link" itemprop="url">iOS 的 hitTest 和 pointInside 小结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-05-01 09:36:47" itemprop="dateCreated datePublished" datetime="2015-05-01T09:36:47Z">2015-05-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>iOS 应用中，处理和触摸有关的事件是一个必不可少的工作。UIKit 本身提供了丰富的常用 UIControl 控件，如 UIButton、UISwitch 等，使用这些控件时只需用 <code>addTarget:action:forControlEvents:</code> 或在 Storyboard 拖出一个 IBAction 就可以轻易实现事件响应；另外，各种各样的 UIGestureRecognizer 也可以为任何 UI 元素添加手势，实现所需的事件处理。</p>
<p>然而，许多场景下需要 App 干涉的 UI 元素的事件响应过程。例如，某个 UIButton 在设计中 frame 很小，而希望它的响应区域更大；或者，App 需要在某些情况下忽略 UIView 的层级关系决定响应 Tap 的元素。</p>
<p>iOS 采用一种叫 <strong>Hit-Testing</strong> 的方式决定接收触摸事件的元素，并提供了 <code>hitTest:withEvent:</code> 和 <code>pointInside:withEvent:</code> 方法允许 View 决定自身是否接收事件，或具体接收事件的 subview，两个方法第一个参数均为一个相对于 View 自身 bounds 的  <code>CGPoint</code>。</p>
<p>一般来说，UIView 在响应到触摸事件时会进行如下判定，同时这也是 <code>hitTest:withEvent:</code> <em>默认</em>的实现：</p>
<ul>
<li>调用自身的 <code>pointInside:withEvent:</code> 方法</li>
<li>若返回为 NO，则拒绝接受该事件，<code>hitTest:withEvent:</code> 返回 nil，Game Over</li>
<li>依次调用自身所有 subview 的 <code>hitTest:withEvent:</code>，调用的顺序从最上层的 subview 开始，直到最底层的 subview 或中途返回了非 nil 的 UIView。</li>
<li>如果在这个过程中遇到了非 nil 的 UIView，则把这个触摸事件交给它，自身的 <code>hitTest:withEvent:</code> 也会成功返回这个 UIView，到此为止。</li>
<li>如果所有 subview 的 <code>hitTest:withEvent:</code> 方法返回均为 nil，则自身处理这个触摸事件，<code>hitTest:withEvent:</code> 方法也会返回 self。</li>
</ul>
<p>而 <code>pointInside:withEvent:</code> 默认实现想必正如字面意思，判定触摸的 CGPoint 是否位于自身 bounds 内。另外需要注意的是，userInteractionEnabled 为 NO 的元素不会响应事件，如 UILabel 和 UIImageView 默认为 NO。</p>
<p>回到之前提到的场景，当 UIButton 自身 frame 过小，如何扩大它响应触摸的区域。一个最常见的做法是改变它的 frame，同时使用 <code>imageEdgeInsets</code> 或 <code>contentEdgeInsets</code> 等方式为它增加 padding，使 UIButton 的 frame 扩大而不增大它其中的内容。</p>
<p>但个人认为这并不是一种非常优雅的方式，设计师同学在设计时，考虑的一般是内容边缘距离父级元素或同级其他元素的距离，对应到用 Auto Layout 开发时，也就是一个相同数值的 NSLayoutConstraint。但若为了改变它的事件处理而改变 frame，配置约束时就会变得复杂和混乱。</p>
<p>而重载这个 UIButton 的 <code>pointInside:withEvent:</code> 方法就可以很好地解决这个问题，由于这个方法的第一个参数是相对于自身 bounds 的 CGPoint，只要判定这个点位于自身 bounds 外围指定距离内的 CGRect 内时返回 YES，就可以在 UIButton 外围响应触摸事件。</p>
<p>横滑滚动多个可以纵向滑动的 UIScrollView（UITableView）也是很多 App 中一个经典的交互设计。而若当这些纵向的 UIScrollView 需要一个公共的 ‘headerView’，并且在它们上滑的时候，希望 UIScrollView 中的内容能遮盖或推走这个 headerView，甚至这个 headerView 还存在可以响应事件的按钮的时候，问题就变得稍微有点微妙。</p>
<p>由于这个 ‘headerView’ 并不希望它属于每个纵向的 UIScrollView，不随着横向滑动而移动，所以它应当独立于横向滑动的 UIScrollView（UICollectionView）之外；由于希望纵向的 UIScrollView 滑动时可以用内容遮盖 headerView 的内容，所以它的层级应该位于横向的 UIScrollView 之下；另外，纵向的 UIScrollView 应该用 contentInset 或透明的 tableHeaderView 让下层的 headerView 露出来。</p>
<p><em>看到这里，我想很多同学会疑问“为什么不用两个纵向的 UIScrollView 嵌套起来”，不过想象一下在滑动内层的 UIScrollView 如何处理就变得头大了吧。</em></p>
<p>此时，这个 ‘headerView’ 由于位于下层，无法响应事件，如果其中有 UIButton，也无法被点击。而利用重载横向滑动的 UIScrollView <code>hitTest:withEvent:</code> 方法，在点击区域位于“本应属于 headerView”的位置时返回 nil，就可以很好地解决这个问题，它的 superview 也自然会把这个事件交给下一个 subview，即这个 headerView 来处理，而这个 headerView 亦会把事件交给对应的 UIButton，最终完成按钮的点击。我在处理这个问题时利用了一个透明的 tableHeaderView，在 <code>hitTest:withEvent:</code> 中调用了它的 super 方法，如果拿到的 UIView 正是这个 tableHeaderView，就直接返回 nil，否则返回 super 的结果。</p>
<p>关于这两个问题，我写了一个简单的 Demo，需要的童鞋可以移步 <a target="_blank" rel="noopener" href="https://github.com/mudkipme/HitTestDemo">GitHub</a>，有不同的想法欢迎扔 Issue : )</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mudkip.me/2014/12/25/Parallels-Worlds/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mudkip">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/12/25/Parallels-Worlds/" class="post-title-link" itemprop="url">Parallels Worlds.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2014-12-25 13:31:42" itemprop="dateCreated datePublished" datetime="2014-12-25T13:31:42Z">2014-12-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>「如果说，有一个和我们所在的世界不同的丰缘地方，神奇宝贝的进化有点不同，也许不存在超进化，也许三千年前没有那场灾难。」——那同样是一个不能破坏的安宁的世界。</p>
<p>「或许存在另一个世界，你阻止了的人是我。」——在他的梦中，被唤醒的超古代神奇宝贝是另一只。</p>
<p>祐树来到未白镇的这一天，神奇宝贝多功能领航员上出现了未曾谋面，但却熟悉的面孔，通信画面上接下来的一言一行，都似记忆深处早已发生的真实。110号道路与小遥的对战，在强烈的既视感之中「再次」完败——唯一不同的只有沼跃鱼倒下前的神态。</p>
<p>在历史的长河中，总有许多命运的分界点上，自然亦或某个生命做出不同的选择，产生了错综复杂，但又相似收束的世界线。在某个时空中，紫菫没有成为室内都市，但那里的游乐场也没有因不能说的理由关闭；在某个时空中，关都四天王有不同于正义使者的过去；在某个时空中有会说话的喵喵和两人组成的三人组。</p>
<p>每一个生命都或多或少有种「命运探知」的能力，相信不只是曼珠、主角和敌对组织首领，每个人都有过Déjà vu的体验。如<a target="_blank" rel="noopener" href="http://wiki.52poke.com/wiki/AG086">AG086</a>，一个时空中某个虚构作品，恰是另一个时空的真实。如果能读到其他世界线中自己的记忆——甚至像<a target="_blank" rel="noopener" href="http://wiki.52poke.com/wiki/XY036">XY036</a>中一样，和另一个自己见面，一定可以「创造」或者「改变」什么。</p>
<p>2014年接触了很多平行世界题材的作品，Ever17的轮回，Virtue’s Last Reward的选择，命运石之门的跳跃；那些为了重要的东西努力改变世界线的故事，每一作都有很深刻的感动。至ORAS变幻篇章的最大收获，不仅仅是坚持「相信」喜欢的世界的存在，而且对于「哪一个」才是「真实」，也有了答案。</p>
<p>不过呢，在这个世界线变动率附近的范围内，现在这个数值就刚刚好呢: )</p>
<p>圣诞快乐。</p>
<p>参考：<a target="_blank" rel="noopener" href="http://azzyfox.tumblr.com/">AzzyFox</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mudkip.me/2014/12/01/Sootopolis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mudkip">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/12/01/Sootopolis/" class="post-title-link" itemprop="url">Sootopolis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2014-12-01 13:39:25" itemprop="dateCreated datePublished" datetime="2014-12-01T13:39:25Z">2014-12-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/images/2014/12/tumblr_nfv5ebOZfY1qgnefzo1_r3_1280.jpg" alt="image-1"></p>
<p>In Sootopolis City, after the end of the extreme weather event.</p>
<blockquote>
<p>Finally, it’s just two of us again.<br>
I’ve got to say…thanks for everything you’ve done for our region, Swam.<br>
You know, I thought we were supposed to have set out from Littleroot together, but…<br>
But you, Swam…<br>
It seems like you just keep getting further and further ahead of me…<br>
I even started to feel like you’d gone somewhere I can’t even reach.<br>
It’s pretty lonely, you know?<br>
Not!<br>
What would you think if I really said something like that?<br>
Hee hee!</p>
</blockquote>
<p>My dear May. Do you know what I’m thinking?</p>
<p>I mean, everything I were able to have done, begins with our first battle near the pool of Route 103, just like you said in Lilycove. I were merely a careless boy who knew nothing about Hoenn, but you welcomed me with the most beautiful smiling face on that day, and taught me how to battle, how to creep near Poochyena. You helped me and encouraged me every time.</p>
<p>I never feel I’m ahead of you. When we met at Lilycove, I noticed your Pokédex was nearly completed. You must have made great efforts to achieve this, and that’s the thing I lag behind you a lot. You are my best friend, and you are never alone.</p>
<p>So…When our journey comes to a new chapter, I wish we get back to Littleroot together, and I want we understand everything about each other and our Pokémon and share our journey together.</p>
<p>And…May we be <a target="_blank" rel="noopener" href="http://wiki.52poke.com/wiki/Together_Forever">together forever</a>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mudkip.me/2014/06/22/Zero-Escape-Virtue%E2%80%99s-Last-Reword/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mudkip">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/06/22/Zero-Escape-Virtue%E2%80%99s-Last-Reword/" class="post-title-link" itemprop="url">Zero Escape: Virtue’s Last Reword</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2014-06-22 13:41:01" itemprop="dateCreated datePublished" datetime="2014-06-22T13:41:01Z">2014-06-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一周多前终于完成了3DS上的「Zero Escape: Virtue’s Last Reword」（極限脱出ADV 善人シボウデス）这部作品。40小时的游戏时间过后，虽然很多谜题和真相解开了，但是留下的困惑和谜题更多了，希望续作（如果有的话）能够一一释疑吧。</p>
<p><a href="http://mudkip.me/post/24341459056/4-leaf-clover">两年多前</a>玩过DS上的前作「9小时9个人9之门」；VLR本作是美版发售就买来了，但因为等Bug修复补丁等了很久（现在也没出）加上胆小不能在平时玩（?）就拖了一年多，然后最近终于想起来一定要体验这作，差一点就错过了。</p>
<p>故事发生在2028年12月25日，前作的一年后，主角和其余8人被绑架到神秘的设施中，被迫参与密室逃脱以及囚徒困境的AB（Ally or Betray）游戏。9个人在游戏开始被佩戴了计数为3的腕表，当在进行几轮AB游戏后计数达到9时就可以脱出游戏，而计数小于等于0时则会遭到「处罚」。和前作一样，这场脱出游戏只是精心设计的密谋，并不是故事的真相。</p>
<p>以下内容涉及剧透，没有玩过本作品的同学请直接前往任天堂3DS eShop商店购买（或PSN购买Vita版），在完成全部结局后再回来看吧。这里推荐下载版是因为传说3DS版有在某个密室（PEC）存档可能损坏存档的Bug（其实我觉得也可能是Feature），下载版可以随时备份存档避免悲剧发生时的损失。</p>
<h3 id="希望">希望</h3>
<p>其实一开始对极限脱出系列有兴趣有制作商Spike Chunsoft的原因，某种程度上「9小时9个人9之门」能找到「神奇宝贝不可思议的迷宫 时/暗之探险队」的影子，剧情中贯穿着隐藏的线索，时间和空间的融合，以及真相结局中包含着的「希望」。</p>
<p>两年前玩999的时候，相当喜欢「四叶草」的设定，四叶草书签的希望·信赖·爱·幸运是大家最终走到真相所必需的东西。而本作也有「希望」的要素，日文标题中的「シボウデス」可写作「死亡」不过也可以写作「志望」吧。</p>
<p>但是游戏的结局并没有看到「希望」，更多的是一种「宿命」的束缚，意识回到过去的Sigma的阻止根号6病毒扩散拯救世界的努力失败，而对45年间的Sigma来说，这一切是过去发生的事实，也因此（?）需要付出45年的努力实施阻止根号6病毒扩散的AB计划。</p>
<p>本作四叶和Alice登场的原因仅仅是为了增幅Sigma和Phi的能力，加上四叶的结局一如既往（?）是最惨痛的多少有些遗憾。但是四叶的人设依旧喜欢就是了，对于主角某些不合年龄（?）的表现的反应也是有趣的地方。</p>
<h3 id="视点">视点</h3>
<p>在最终章「Another Time」中玩家的视角变成了K，但K却知道很多他「不该知道的事情」，茜最后表示「你不是K，你不需要遵守我们的规则，你是我们的系统里一个独特的变量」的时候，瞬间想到了打越钢太郎另一部作品「Ever17」中的设定，然后看到Wiki中讲PSV版中完成最终章的成就叫做「A Certain Point Of View」证实了我的猜测。</p>
<p>「我」就是「视点」，四次元生物「Blick Winkel」，在Sigma博士的影像中其实也暗示了更高次元智慧的存在；但是无论如何套用Ever17中Blick Winkel的所作所为，并不能拯救VLR中的世界，比起挽救两个人的生命，改变整个45年的历史对「视点」来说要难得多。</p>
<h3 id="薛定谔的猫">薛定谔的猫</h3>
<p>「 <strong>Reality is shaped by what we believe reality should be.</strong> 」</p>
<p>在接触这作很久之前我就是薛定谔的猫的不科学解释（?）的支持者，因此从来回避体检一类的事情。本作引出了薛定谔的猫（如果外部世界是装着猫的盒子，这个密封设施是观察者），Phi线中也应用了一次这个理论（茜这次并没有被Dio所杀），最终章Alice说茜提到了解决悖论的办法就是「薛定谔的猫」，不过如何应用薛定谔的猫来拯救世界就要等到续作了。</p>
<h3 id="Bluebird">Bluebird</h3>
<p>Bluebird是Sigma送给Luna的音乐盒，来源于「メーテルリンクの青い鳥 チルチルミチルの冒険旅行」，包含了笼子里的鸟、幸福得而复失的寓意。</p>
<p>2028年12月31日究竟发生了什么，E路线的世界是否可以存在，Santa在做什么，Phi的真实身份等等谜题都需要在下一作中揭示。但由于日本销量不佳的原因，Spike Chunsoft暂停了极限脱出第三作开发。玩家为了表示对系列的支持发起了<a target="_blank" rel="noopener" href="https://www.facebook.com/operationbluebirdze3">Operation Bluebird</a>行动，很短的时间内就得到了上万支持；打越钢太郎目前正在进行其他作品的工作，如果顺利的话，之后极限脱出第三作恢复开发并不是不可能。</p>
<p>所以相信VLR续作一定会登场，比起整个AB计划，Operation Bluebird的成功要容易得多呢。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mudkip.me/2014/01/05/%E5%A6%82%E4%BD%95%E7%94%A8%E5%BE%97%E8%B5%B7-MediaWiki/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Mudkip">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Mudkip Mud Sport">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2014/01/05/%E5%A6%82%E4%BD%95%E7%94%A8%E5%BE%97%E8%B5%B7-MediaWiki/" class="post-title-link" itemprop="url">如何用得起 MediaWiki</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2014-01-05 20:42:16" itemprop="dateCreated datePublished" datetime="2014-01-05T20:42:16Z">2014-01-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.mediawiki.org/">MediaWiki</a> 最初为运行维基百科而设计的开源程序，目前服务于超过一万的 Wiki 站点。<a target="_blank" rel="noopener" href="http://wiki.52poke.com/">神奇宝贝百科</a>自2010年9月起运行于 MediaWiki，3年多来积累了很多心得，虽然内容和访问量迅速增长，但服务器开支依然保持在负担得起的范围。水跃希望在这里记录和分享。</p>
<p>日志标题中「用得起」的假设是运行在一台 1GB RAM 虚拟（云）服务器，日页面访问量在一百万以内。市场上 1GB RAM 的 VPS 价格约 10 ～ 30 美元每月。MediaWiki 并不适合运行在共享虚拟主机，或内存不到 512MB 的服务器中。</p>
<p>另外，<a target="_blank" rel="noopener" href="http://www.mediawiki.org/wiki/Manual:Performance_tuning">MediaWiki 官方网站</a>提供了一些基本的优化方式，非常值得参考。</p>
<h2 id="MediaWiki-很耗资源么">MediaWiki 很耗资源么</h2>
<p>是的。相较其他流行的 PHP 开源应用，MediaWiki 可以认为更耗资源，尤其是 CPU 使用，一篇包含复杂模板嵌套的文章，在无缓存状态下的渲染时间可能长达数秒，甚至数十秒。</p>
<p>经历了十多年的发展，MediaWiki 也是一个<a target="_blank" rel="noopener" href="http://aosabook.org/en/mediawiki.html">架构设计优雅</a>的工程，具有非常强大的功能和可定制性，其性能开销往往是必要的。合理运用多重优化手段方式，可以有效降低 MediaWiki 的性能开销。</p>
<h2 id="使用高性能的-Web-服务器程序">使用高性能的 Web 服务器程序</h2>
<p>如果在生产环境使用最新版本的服务器程序，往往会引起很大的争议。但事实上，开源程序往往可以保持对较新版本系统环境很好的兼容性，新版本的系统环境往往具有更少的 Bug 和非常大的性能提升。</p>
<p><a target="_blank" rel="noopener" href="http://52poke.com/">52Poké</a> 所在的虚拟服务器采取了较为激进的做法，自2011年后一直使用 <a target="_blank" rel="noopener" href="https://www.archlinux.org">Arch Linux</a> 操作系统，其滚动升级的特性可以让包管理（pacman）安装的应用都保持在最新版本，同时 Linode 也默认提供了最新版本的 Linux 内核。虽然对基础服务大版本的升级危险较大，但两年多来数十次 <code>pacman -Syu</code> 并未带来很大麻烦，除了在某几个凌晨造成数十分钟的不可用（都是由于较长时间未升级造成跨度较大并且操作失误）。</p>
<p>回到主题，对 MediaWiki 而言，高性能的 Web 服务器程序除了意味着 PHP 5.5，MySQL/MariaDB 5.5+；也包括使用 PHP 5.5 内置的 <a target="_blank" rel="noopener" href="http://php.net/opcache">OPcache</a> 加速，以及使用 <a target="_blank" rel="noopener" href="http://nginx.org">Nginx</a> + <a target="_blank" rel="noopener" href="http://php-fpm.org">php-fpm</a> 代替 Apache，<a target="_blank" rel="noopener" href="http://memcached.org">Memcached</a> 和/或 <a target="_blank" rel="noopener" href="http://redis.io">Redis</a> 缓存等。</p>
<p>当前支持神奇宝贝百科的<a target="_blank" rel="noopener" href="http://wiki.52poke.com/wiki/Special:%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF">服务器程序</a>为 PHP 5.5.7，MariaDB（MySQL 对社区友好的一个变体）5.5.34，Nginx 1.4.4 以及 Memcached 1.4.17。</p>
<h2 id="合理的配置文件">合理的配置文件</h2>
<p>MediaWiki 的默认配置（<code>LocalSettings.php</code>）并不适合生产环境，这里简要介绍一个低能耗的 MediaWiki 系统需要增加的配置项：</p>
<ul>
<li><code>$wgDisableCounters = true;</code> 关闭内置的统计功能，如需要统计访问量可以使用 Google Analytics 等外部服务。</li>
<li><code>$wgWellFormedXml = false;</code> 以及 <code>$wgHtml5 = true;</code> 打开 HTML5 标签输出并关闭兼容 XML 语法，可以降低页面的体积。</li>
<li><code>$wgShowIPinHeader = false;</code> 关闭未登录用户在右上角显示 IP 地址，以便使用静态缓存。</li>
<li><code>$wgUseGzip = true;</code> 开启 gzip 压缩，降低页面体积，另外也可在 Web 服务器中配置开启 gzip。</li>
<li><code>$wgMiserMode = true;</code> 关闭实时生成特殊页面；建议同时在 cron 里配置定时任务，定期生成特殊页面。</li>
<li><code>$wgJobRunRate = 0.01;</code> 减少执行任务的频率（即每次请求有1%的几率运行任务）；MediaWiki 的任务往往需要耗费数秒的时间执行，默认运行频率为1，一旦插入任务就可能导致 PHP 进程全部被占满；这里同样建议在 cron 里配置定时任务运行 MediaWiki 的任务，以免使任务队列积累过多。</li>
<li><code>$wgInvalidateCacheOnLocalSettingsChange = false;</code> 关闭修改 LocalSettings.php 使所有缓存失效的特性；MediaWiki 的缓存完全失效是非常可怕的，几乎可以迅速致服务器僵死。</li>
</ul>
<h2 id="服务器端缓存">服务器端缓存</h2>
<p>MediaWiki 的稳定运行，opcode 缓存、object 缓存和页面缓存都是必不可少的。</p>
<h3 id="opcode-缓存">opcode 缓存</h3>
<p>opcode 缓存用于加速 PHP 脚本的执行。PHP 5.5 内置了 OPcache（即之前的 ZendOptimizer+），比起 eAccelerator、XCache 和 APC 有更好的性能，只需在 php.ini 中引用 <a target="_blank" rel="noopener" href="http://opcache.so">opcache.so</a> 即可使用，同时 OPcache 也可单独安装在 PHP 5.4 或 5.3 环境中。另外需要注意 PHP 5.5.1 及 5.5.2 内置的 OPcache 和 MediaWiki 存在兼容问题，5.5.3 以上版本已解决。</p>
<h3 id="object-缓存">object 缓存</h3>
<p>MediaWiki 可以利用 object 缓存存储包括界面语言文字、文件信息、模板生成的中间产物、最终页面渲染 HTML 等数据。MediaWiki 支持使用 APC、XCache、Memcached、Redis、MySQL 数据库方式缓存数据，但配置中默认未开启 object 缓存功能。在这几种缓存方式中，除 MySQL 数据库外都需要在内存中存储，其中前3种存储方式无法持久化。</p>
<p>这里推荐使用是 Memcached 和 MySQL 结合的方式，配置方式如下：</p>
<pre>$wgMainCacheType = CACHE_MEMCACHED;   
$wgMemCachedServers = array('127.0.0.1:11211');  
$wgParserCacheType = CACHE_DB;</pre>
<p>Memcached 由于将数据存储在内存中，读写速度非常快；存储相同内容的数据占据的内存空间也是几种方式中最小。但 Parser Cache 由于包含了页面完整的 HTML 文本，需要的体积非常大，同时一旦失效则会需要重新解析所有页面，带来巨大的 CPU 开销；在内存有限的条件下更适合存储到较为持久的 MySQL 数据库中。</p>
<p>神奇宝贝百科在2013年初使用 Memcached 曾频繁遇到 Segfault，因此更换到 Redis + MySQL 结合的方式，但 Redis 耗费了更多内存（仅指在 MediaWiki 的使用方式下），也有相对较大的 I/O 使用。2013年12月 Memcached 发布了 1.4.17 更新，解决了不稳定的问题，因此目前又换回使用 Memcached。</p>
<h3 id="页面缓存">页面缓存</h3>
<p>作为一个 Wiki，对未登录用户而言页面几乎是静态的，所以页面缓存可以非常有效；MediaWiki 提供了 <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Manual:File_cache">File cache</a> 功能，另外也可以使用 <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Manual:Squid_caching">Squid</a> 或 <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Manual:Varnish_caching">Varnish</a> 的功能。而对于只有一台服务器的站点而言，这里更推荐使用 Nginx 自带的 FastCGI 缓存功能。</p>
<p>MediaWiki 默认会根据请求头中的 Accept-Language（即用户浏览器语言）、Cookie 等因素区分不同的页面缓存（可见响应头中的 Vary 行）。但对于单一语言、没有文字变种的 Wiki，只要已登录用户不使用页面缓存，未登录用户访问则看到相同的页面内容即可。</p>
<p>以下是神奇宝贝百科的 FastCGI 缓存配置，为便于介绍去掉了中文简繁处理相关的内容。这里缓存有效期为5小时，可以根据实际情况修改。另外，特殊页面不宜开启静态缓存（如最近更改和随机页面）。</p>
<pre>http {
    ...
    fastcgi_cache_path  /var/cache/nginx/wiki levels=2:2 keys_zone=wiki:128m inactive=5h max_size=2048m;
    
    server {
        ...
        if ($http_cookie ~* "52poke_wikiUserID") {
            set $do_not_cache 1;
        }
        if ($uri ~ "^/wiki/Special:") {
            set $do_not_cache 1;
        }
        if ($args ~ "Special:") {
            set $do_not_cache 1;
        }
        fastcgi_cache wiki;
        fastcgi_ignore_headers Cache-Control Expires;
        fastcgi_hide_header Vary;
        fastcgi_cache_key $uri$is_args$args;
        fastcgi_cache_bypass $do_not_cache;
        fastcgi_no_cache $do_not_cache;
        fastcgi_cache_valid  200 5h;
        fastcgi_cache_valid  301 0;
        fastcgi_cache_valid  404 20m;
    }
}</pre>
<p>使用页面缓存就会遇到缓存更新的问题，好在 MediaWiki 提供了 PURGE 功能，配置后只要相应的页面有更新就会发出 HTTP PURGE 请求。<code>LocalSettings.php</code> 中的配置如下：</p>
<pre>$wgUseSquid = true;
$wgSquidServers = array('127.0.0.1’);</pre>
<p>这里只配置了 127.0.0.1 因 52Poké 只有一台前端服务器，并且和 MediaWiki 程序是同一台。不过 Nginx 默认并不支持 PURGE 请求，可以编译安装 <a target="_blank" rel="noopener" href="http://labs.frickle.com/nginx_ngx_cache_purge/">ngx_cache_purge</a> 扩展实现，具体操作步骤可以<a target="_blank" rel="noopener" href="http://mcnearney.net/blog/2010/2/28/compiling-nginx-cache-purging-support/">参考这里</a>。</p>
<p>对于具有文字变种，如中文简繁之分的 Wiki，则情况较为复杂，今后这里会详细讨论 MediaWiki 处理中文简繁的问题，本篇就不详述了。</p>
<h2 id="减少模板和文章内容渲染的开销">减少模板和文章内容渲染的开销</h2>
<p>MediaWiki 提供了非常强大的模板和语法处理功能，尤其是内置的 ParserFunctions 扩展，但语法解析需要非常大的 CPU 开销。</p>
<p>这里建议尽可能减少不必要的模板使用和嵌套。例如对于一些通用的文字、背景颜色、边框样式，更适合在 <code>MediaWiki:Common.css</code> 或小工具中使用 CSS 实现。如果文章在编辑后需要等待很长的时间才能加载出来，则需要对其中使用的模板进行优化，必要时可以考虑拆分文章。</p>
<p>MediaWiki 解析图片信息也需要较大的资源消耗，对于较为固定的图片、尤其是尺寸较小的图片，推荐使用 CSS Sprites 而非通过 Wiki 上传。</p>
<p>MediaWiki 也会对包含过多模板嵌套、或者使用了过多语法呼叫（例如 switch 和 if 语法）的文章自动添加警示的分类。</p>
<h2 id="选择合适的服务商">选择合适的服务商</h2>
<p>基础硬件的性能往往是第一位的，对运行 MediaWiki 而言，CPU、内存、I/O 性能、网络带宽都至关重要。其实早在2006年 52Poké 就搭建了 MediaWiki，但在有上百篇文章之后当时所在的虚拟主机就不堪重负，不得不在后来转型使用自建的程序，直到2010年开始使用 Linode。</p>
<p>就 52Poké 使用 <a target="_blank" rel="noopener" href="https://www.linode.com/?r=f7340c28b6c910d5b5369471c4a029b71eb9b015">Linode</a><em>（推介链接）</em> 的经历而言，Linode 是一家不错的 VPS 提供商，但并不算完美。Linode 在2013年进行了多次升级，在流量、网络速度、CPU 性能和性价比方面有较大优势。</p>
<p>VPS 有一个不稳定因素是 CPU 和 I/O 性能会受同一台物理服务器的邻居影响，52Poké 曾遇到过 CPU %Steal 过高导致性能较差的问题，不过联系客服很快迁移了另一台物理服务器解决。Linode 的 I/O 性能比提供了 SSD 的服务商要差，目前 Linode 只在纽瓦克数据中心提供了测试版 SSD 服务，亚洲用户较多使用的东京数据中心则尚未提供。</p>
<h2 id="其他和未来">其他和未来</h2>
<p>到这里已经介绍了高性能 MediaWiki 站点的必要条件。不过对于拥有较多图片的 Wiki 来说，可能很容易遇到流量超限或 I/O 消耗较大的问题，推荐如有必要添加一台流量较为廉价的 VPS 存放或缓存图片；另外可以考虑将图片延迟加载，即当浏览者滚动到图片位置时再加载，该功能的 MediaWiki 扩展在完成开发后会开源。</p>
<p>关于 MediaWiki，除了性能之外，还有很多值得讨论的话题。比如扩展，小工具（Gadget），中文的繁简问题，条目命名和内容规范，自动化批量建设内容，版权问题，以及作为一个 Wiki 社群的建设和发展。这些就留在以后继续讨论吧。</p>
<p>对于未来，如何支持移动设备，如何进一步减少服务器端模板的开销是水跃在继续思考的问题。MediaWiki 官方提供了 <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Extension:MobileFrontend">MobileFrontend</a> 扩展，但根据设备输出不同的内容会带来更多的复杂度和资源消耗，而且可能降低了移动设备的体验；所以我更希望有响应式的方案。对于复杂的表格如果可以服务器只在页面中输出元数据，由 JavaScript 在浏览器中渲染的话，就可以减轻服务器的压力。但修改 Wiki 的 JavaScript 和 CSS 的权限往往不会开放给普通用户，这样做对社区并不利。</p>
<p>2014年的第一篇终于啰嗦完了，这里祝各位新年快乐，也希望 MediaWiki 的同好有所收获吧: )</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Mudkip</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>



  





</body>
</html>
